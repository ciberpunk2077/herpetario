{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    .form-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border: 1px solid #e9ecef;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .checkbox-custom {
        width: 20px;
        height: 20px;
        accent-color: #2A9D8F;
    }
    
    /* Estilos espec√≠ficos para evitar conflictos con floating-label-form-group */
    .serpiente-form input,
    .serpiente-form select,
    .serpiente-form textarea {
        position: static !important;
        z-index: auto !important;
        padding: 0.75rem 1rem !important;
        border: 1px solid #d1d5db !important;
        border-radius: 0.5rem !important;
        font-size: 1rem !important;
        background: #f0fdf4 !important;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important;
        resize: vertical !important;
    }
    
    .serpiente-form label {
        position: static !important;
        top: auto !important;
        opacity: 1 !important;
        font-size: 0.875rem !important;
        font-weight: 600 !important;
        color: #374151 !important;
        margin-bottom: 0.5rem !important;
        display: block !important;
        z-index: auto !important;
    }
    
    .serpiente-form textarea {
        min-height: 128px !important;
    }
    
    /* Asegurar que los campos de especie no se superpongan */
    .serpiente-form select option {
        background: white !important;
        color: #374151 !important;
    }
    
    /* Limitar el ancho del campo especie */
    .serpiente-form #id_especie {
        max-width: 300px !important;
        width: 100% !important;
    }
    
    /* Asegurar que el contenedor del campo especie tambi√©n tenga ancho limitado */
    .especie-field-container {
        max-width: 300px !important;
    }
</style>

<div class="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 py-8">
    <div class="container mx-auto px-4">
        <!-- Header Section -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center space-x-3 mb-4">
                <svg class="w-12 h-12 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
                <h1 class="text-4xl font-bold text-secondary">
                    {% if edit %}
                        ‚úèÔ∏è Editar Serpiente
                    {% else %}
                        üêç Nueva Serpiente
                    {% endif %}
                </h1>
            </div>
            <p class="text-gray-600 text-lg max-w-2xl mx-auto">
                {% if edit %}
                    Modifica la informaci√≥n de la serpiente seleccionada
                {% else %}
                    Agrega una nueva serpiente al cat√°logo del herpetario
                {% endif %}
            </p>
        </div>

        <!-- Form Card -->
        <div class="max-w-4xl mx-auto">
            <div class="form-card rounded-xl p-8">
                <form method="post" enctype="multipart/form-data" class="space-y-6 serpiente-form">
                    {% csrf_token %}
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Columna izquierda: Familia, G√©nero, Especie -->
                        <div class="space-y-6">
                            <!-- Familia -->
                            <div>
                                <label for="{{ form.familia.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                    <span class="text-red-500">*</span> Familia
                                </label>
                                <div class="flex flex-row items-center gap-1">
                                    {{ form.familia }}
                                    <button type="button" class="bg-primary text-white rounded-lg font-bold flex items-center justify-center text-lg h-10 w-10 ml-0 hover:bg-teal-700 transition" style="margin-left:5px;" onclick="openFamiliaModal()" title="Agregar familia">
                                        +
                                    </button>
                                </div>
                                {% if form.familia.errors %}
                                    <div class="mt-2 text-red-600 text-sm">
                                        {{ form.familia.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>
                            <!-- G√©nero -->
                        <div>
                            <label for="{{ form.genero.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                <span class="text-red-500">*</span> G√©nero
                            </label>
                                <div class="flex flex-row items-center gap-1">
                                    {{ form.genero }}
                                    <button type="button" id="btnNuevoGenero" class="bg-primary text-white rounded-lg font-bold flex items-center justify-center text-lg h-10 w-10 ml-0 hover:bg-teal-700 transition" style="margin-left:5px;" onclick="openGeneroModal()" title="Crear nuevo g√©nero">
                                        +
                                    </button>
                                </div>
                                <div id="msgNoGeneros" class="text-sm text-gray-500 mt-2 hidden">No hay g√©neros para esta familia.</div>
                            {% if form.genero.errors %}
                                <div class="mt-2 text-red-600 text-sm">
                                    {{ form.genero.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                            <!-- Especie -->
                            <div class="especie-field-container">
                                <label for="{{ form.especie.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                    <span class="text-red-500">*</span> Especie
                            </label>
                                <div class="flex flex-row items-center gap-1">
                                    {{ form.especie }}
                                    <button type="button" id="btnNuevaEspecie" class="bg-primary text-white rounded-lg font-bold flex items-center justify-center text-lg h-10 w-10 ml-0 hover:bg-teal-700 transition" style="margin-left:5px;" onclick="openEspecieModal()" title="Crear nueva especie">
                                        +
                                    </button>
                                </div>
                                <div id="msgNoEspecies" class="text-sm text-gray-500 mt-2 hidden">No hay especies para este g√©nero.</div>
                                {% if form.especie.errors %}
                                    <div class="mt-2 text-red-600 text-sm">
                                        {{ form.especie.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>
                            <!-- Imagen -->
                            <div>
                                <label for="{{ form.imagen.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Imagen de la especie
                                </label>
                                {% if form.instance.imagen %}
                                    <div class="mb-2">
                                        <img src="{{ form.instance.imagen.url }}" alt="Imagen actual" class="h-48 w-full object-cover rounded shadow border"/>
                                        <p class="text-xs text-gray-500">Imagen actual</p>
                                    </div>
                                {% endif %}
                                <input type="file" name="imagen" id="{{ form.imagen.id_for_label }}" class="form-input w-full px-4 py-3 rounded-lg bg-green-50" accept="image/*">
                                {% if form.imagen.errors %}
                                <div class="mt-2 text-red-600 text-sm">
                                        {{ form.imagen.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                        <!-- Columna derecha: Resto de la informaci√≥n -->
                        <div class="space-y-6">
                            <!-- Nombre com√∫n -->
                        <div>
                            <label for="{{ form.nombre_comun.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Nombre com√∫n
                            </label>
                                {{ form.nombre_comun }}
                            {% if form.nombre_comun.errors %}
                                <div class="mt-2 text-red-600 text-sm">
                                    {{ form.nombre_comun.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                            <!-- Subtipo -->
                        <div>
                            <label for="{{ form.subtipo.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                Subtipo
                            </label>
                                {{ form.subtipo }}
                            {% if form.subtipo.errors %}
                                <div class="mt-2 text-red-600 text-sm">
                                    {{ form.subtipo.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                            <!-- H√°bitat -->
                        <div>
                            <label for="{{ form.habitat.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                H√°bitat
                            </label>
                                {{ form.habitat }}
                            {% if form.habitat.errors %}
                                <div class="mt-2 text-red-600 text-sm">
                                    {{ form.habitat.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                            <!-- Descripci√≥n -->
                            <div>
                                <label for="{{ form.descripcion.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Descripci√≥n
                                </label>
                                {{ form.descripcion }}
                                {% if form.descripcion.errors %}
                                    <div class="mt-2 text-red-600 text-sm">
                                        {{ form.descripcion.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>
                            <!-- Peligro de extinci√≥n -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                Estado de Conservaci√≥n
                            </label>
                            <div class="flex items-center space-x-3 p-4 bg-gray-50 rounded-lg">
                                    {{ form.peligro_extincion }}
                                <label for="{{ form.peligro_extincion.id_for_label }}" class="text-gray-700">
                                    <span class="font-medium">En peligro de extinci√≥n</span>
                                    <p class="text-sm text-gray-500">Marcar si la especie est√° amenazada</p>
                                </label>
                            </div>
                            {% if form.peligro_extincion.errors %}
                                <div class="mt-2 text-red-600 text-sm">
                                    {{ form.peligro_extincion.errors.0 }}
                                </div>
                            {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200">
                        <button type="submit" class="flex-1 bg-primary hover:bg-teal-700 text-white py-3 px-6 rounded-lg font-semibold transition duration-300 flex items-center justify-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            </svg>
                            <span>
                                {% if edit %}
                                    Actualizar Serpiente
                                {% else %}
                                    Crear Serpiente
                                {% endif %}
                            </span>
                        </button>
                        <a href="{% url 'catalogo:serpiente-list' %}" 
                           class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-lg font-semibold transition duration-300 flex items-center justify-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                            <span>Cancelar</span>
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modales y JS para AJAX -->
<script src="{% static 'js/modal-ajax.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Aplicar fondo a todos los inputs y selects del formulario
    document.querySelectorAll('input[type="text"], input[type="file"], select, textarea').forEach(function(el) {
        el.classList.remove('bg-blue-50');
        el.classList.add('bg-green-50');
    });
});
</script>
{% endblock %} 